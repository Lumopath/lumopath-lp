import { notFound } from 'next/navigation';
import { performRequest } from '@/lib/datocms';
import './../page.scss';

const QUERY = `
  query {
    layout {
      complianceVulnerabilityDisclosurePolicy {
        url
        title
        mimeType
      }
    }
  }
`;

export async function generateMetadata() {
  const { data } = await performRequest({ query: QUERY });

  return {
    title:
      data?.layout?.complianceVulnerabilityDisclosurePolicy?.title ||
      'Compliance vulnerability disclosure policy',
  };
}

export default async function complianceVulnerabilityDisclosurePolicyPage() {
  const { data } = await performRequest({ query: QUERY });
  const fileUrl = data?.layout?.complianceVulnerabilityDisclosurePolicy?.url;
  const mimeType =
    data?.layout?.complianceVulnerabilityDisclosurePolicy?.mimeType ||
    'application/pdf';

  if (!fileUrl) {
    notFound();
  }

  return (
    <embed
      src={fileUrl}
      type={mimeType}
      width='100%'
      style={{ border: 'none', height: '100dvh' }}
    />
  );
}
